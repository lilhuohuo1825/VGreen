<!-- Blog Management Page -->
<div class="blogs-page" (click)="closeDropdowns($event)">
  <!-- Breadcrumb -->
  <div class="breadcrumb">
    <span>Qu·∫£n tr·ªã vi√™n</span>
    <span class="separator">/</span>
    <span class="clickable" (click)="navigateToBlogList()" *ngIf="viewMode === 'detail'">Qu·∫£n l√Ω Blogs</span>
    <span *ngIf="viewMode === 'list'">Qu·∫£n l√Ω Blogs</span>
    <span class="separator">/</span>
    <span class="current" *ngIf="viewMode === 'list'">Danh s√°ch b√†i vi·∫øt</span>
    <span class="current" *ngIf="viewMode === 'detail' && !isNewBlog">Chi ti·∫øt b√†i vi·∫øt</span>
    <span class="current" *ngIf="viewMode === 'detail' && isNewBlog">Th√™m b√†i vi·∫øt</span>
  </div>

  <!-- Page Header -->
  <div class="page-header" *ngIf="viewMode === 'list'">
    <div class="page-title-section">
      <h1 class="page-title">DANH S√ÅCH B√ÄI VI·∫æT</h1>
      <p class="blogs-info" *ngIf="!isLoading && blogs.length > 0">
        Hi·ªÉn th·ªã <strong>{{blogs.length}}</strong> b√†i vi·∫øt
      </p>
    </div>
    <button class="btn-add-blog" (click)="addNewBlog()">
      <img src="/asset/icons/plus.png" alt="Add">
      <span>Th√™m b√†i vi·∫øt</span>
    </button>
  </div>

  <!-- Toolbar -->
  <div class="toolbar" *ngIf="viewMode === 'list'">
    <!-- Actions -->
    <div class="actions-container">
      <!-- Search Container -->
      <div class="search-container">
        <input type="text" class="search-input" placeholder="T√¨m ki·∫øm" [(ngModel)]="searchQuery" (input)="searchBlogs($event)">
        <button class="search-btn">
          <img src="/asset/icons/search_dark.png" alt="Search">
        </button>
      </div>
      
      <span class="selected-count">{{selectedCount}} ƒë√£ ch·ªçn</span>
      
      <button class="btn-action btn-edit" (click)="editBlogs()" [disabled]="selectedCount === 0">
        <img src="/asset/icons/edit_dark.png" alt="Edit">
        <span>Ch·ªânh</span>
      </button>
      
      <button class="btn-action btn-delete" (click)="deleteBlogs()" [disabled]="selectedCount === 0">
        <img src="/asset/icons/trash_red.png" alt="Delete">
        <span>Xo√°</span>
      </button>
      
      <!-- Sort Dropdown -->
      <div class="dropdown-container">
        <button class="btn-action btn-sort" [class.active]="showSortDropdown" (click)="toggleSortDropdown($event)">
          <span class="icon-sort">‚áÖ</span>
          <span>S·∫Øp x·∫øp {{showSortDropdown ? '‚úì' : ''}}</span>
          <span class="dropdown-arrow">‚ñº</span>
        </button>
        
        <!-- Sort Dropdown Menu -->
        <div class="dropdown-menu dropdown-menu-sort" *ngIf="showSortDropdown" (click)="$event.stopPropagation()">
          <!-- Sort by Date -->
          <div class="sort-option" 
               [class.active]="currentSortBy === 'date'" 
               (click)="currentSortBy === 'date' ? toggleSortOrder() : sortByDate('desc')">
            <div class="sort-option-icon">
              <img src="/asset/icons/calendar.png" alt="Calendar" style="width: 24px; height: 24px;">
            </div>
            <div class="sort-option-content">
              <div class="sort-option-label">Ng√†y c·∫≠p nh·∫≠t</div>
              <div class="sort-option-desc">C≈© ƒë·∫øn m·ªõi / M·ªõi ƒë·∫øn c≈©</div>
            </div>
            <div class="sort-option-indicator">
              <span *ngIf="currentSortBy === 'date'" style="color: #10B981; font-size: 20px; margin-right: 8px;">‚úì</span>
              <div class="indicator-badge" *ngIf="currentSortBy === 'date'" [class.asc]="currentSortOrder === 'asc'" [class.desc]="currentSortOrder === 'desc'">
                <span class="indicator-icon">{{currentSortOrder === 'asc' ? '‚Üì' : '‚Üë'}}</span>
              </div>
            </div>
          </div>

          <!-- Sort by Views -->
          <div class="sort-option" 
               [class.active]="currentSortBy === 'views'" 
               (click)="currentSortBy === 'views' ? toggleSortOrder() : sortByViews('desc')">
            <div class="sort-option-icon">
              <img src="/asset/icons/eye_show_dark.png" alt="Views" style="width: 24px; height: 24px;">
            </div>
            <div class="sort-option-content">
              <div class="sort-option-label">L∆∞·ª£t xem</div>
              <div class="sort-option-desc">Th·∫•p ƒë·∫øn cao / Cao ƒë·∫øn th·∫•p</div>
            </div>
            <div class="sort-option-indicator">
              <span *ngIf="currentSortBy === 'views'" style="color: #10B981; font-size: 20px; margin-right: 8px;">‚úì</span>
              <div class="indicator-badge" *ngIf="currentSortBy === 'views'" [class.asc]="currentSortOrder === 'asc'" [class.desc]="currentSortOrder === 'desc'">
                <span class="indicator-icon">{{currentSortOrder === 'asc' ? '‚Üì' : '‚Üë'}}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading && viewMode === 'list'">
    <div class="loading-spinner"></div>
    <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="loadError && viewMode === 'list'">
    <p class="error-message">{{ loadError }}</p>
    <button class="btn-retry" (click)="loadBlogs()">Th·ª≠ l·∫°i</button>
  </div>

  <!-- Blog Table -->
  <div class="blogs-table-container" *ngIf="!isLoading && !loadError && viewMode === 'list'">
    <table class="blogs-table">
      <thead>
        <tr>
          <th class="col-checkbox">
            <input 
              type="checkbox" 
              class="checkbox-all"
              [checked]="selectAll"
              (change)="toggleSelectAll()"
            >
          </th>
          <th class="col-id">M√É B√ÄI VI·∫æT</th>
          <th class="col-title">B√ÄI VI·∫æT</th>
          <th class="col-date">NG√ÄY C·∫¨P NH·∫¨T</th>
          <th class="col-author">NG∆Ø·ªúI VI·∫æT</th>
          <th class="col-category">CATEGORY</th>
          <th class="col-views">L∆Ø·ª¢T XEM</th>
        </tr>
      </thead>
      <tbody>
        <tr 
          *ngFor="let blog of blogs" 
          [class.selected]="blog.selected"
        >
          <td class="col-checkbox" (click)="$event.stopPropagation()">
            <input 
              type="checkbox" 
              class="checkbox-item"
              [checked]="blog.selected"
              (change)="toggleBlog(blog)"
            >
          </td>
          <td class="col-id">{{ blog.blog_id }}</td>
          <td class="col-title clickable" (click)="viewBlogDetail(blog)">{{ blog.title }}</td>
          <td class="col-date">{{ blog.updated_date || formatDate(blog.created_date) }}</td>
          <td class="col-author">{{ blog.author }}</td>
          <td class="col-category">
            <span class="category-badge">{{ blog.category }}</span>
          </td>
          <td class="col-views">{{ blog.views }}</td>
        </tr>
      </tbody>
    </table>

    <!-- Empty State -->
    <tr class="no-blogs" *ngIf="blogs.length === 0">
      <td colspan="7">
        <p>Kh√¥ng t√¨m th·∫•y b√†i vi·∫øt n√†o</p>
      </td>
    </tr>
  </div>

  <!-- Blog Detail View -->
  <div class="blog-detail-container" *ngIf="viewMode === 'detail' && currentBlog">
    <!-- Back Button at Top -->
    <button class="btn-back-top" (click)="backToList()">
      <img src="/asset/icons/arrowleft_dark.png" alt="Back">
      <span>Quay l·∫°i danh s√°ch</span>
    </button>

    <!-- Page Header -->
    <div class="page-header detail-header">
      <div class="page-title-section">
        <h1 class="page-title" *ngIf="!isNewBlog">CHI TI·∫æT B√ÄI VI·∫æT</h1>
        <h1 class="page-title" *ngIf="isNewBlog">TH√äM B√ÄI VI·∫æT M·ªöI</h1>
      </div>
    </div>

    <!-- Blog Details Content -->
    <div class="blog-detail-content">
      <!-- Top Section: Preview Card + Action Buttons -->
      <div class="blog-top-section">
        <!-- Left: Preview Card -->
        <div class="blog-preview-card">
          <button class="btn-edit-icon" title="Ch·ªânh s·ª≠a" (click)="openEditPopup()">
            <img src="/asset/icons/edit_dark.png" alt="Edit">
          </button>
          
          <div class="preview-layout">
            <div class="preview-avatar">
              <img src="/asset/icons/avatar_dark.png" alt="Author">
            </div>
            
            <div class="preview-info">
              <div class="preview-title">{{ currentBlog.title || 'Ch∆∞a c√≥ ti√™u ƒë·ªÅ' }}</div>
              <div class="preview-row">
                <span class="preview-label">T√°c gi·∫£:</span>
                <span class="preview-value">{{ currentBlog.author || 'Ch∆∞a nh·∫≠p' }}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Email:</span>
                <span class="preview-value">{{ currentBlog.email || 'Ch∆∞a nh·∫≠p' }}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Ng√†y c·∫≠p nh·∫≠t:</span>
                <span class="preview-value">{{ currentBlog.updated_date || formatDate(currentBlog.created_date) }}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Category:</span>
                <span class="preview-value">{{ currentBlog.category || 'Ch∆∞a nh·∫≠p' }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Right: Action Buttons -->
        <div class="blog-actions">
          <button class="btn-delete-blog" (click)="deleteCurrentBlog()" *ngIf="!isNewBlog">
            <img src="/asset/icons/trash_red.png" alt="Delete">
            <span>X√≥a b√†i vi·∫øt</span>
          </button>
          <button class="btn-save-blog" (click)="saveCurrentBlog()">
            <img src="/asset/icons/edit.png" alt="Save">
            <span>{{ isNewBlog ? 'Th√™m b√†i vi·∫øt' : 'L∆∞u b√†i vi·∫øt' }}</span>
          </button>
        </div>
      </div>

      <!-- Blog Content Section -->
      <div class="blog-content-card">
        <div class="content-editor-header">
          <h3 class="content-editor-title">N·ªôi dung b√†i vi·∫øt</h3>
        </div>
        
        <!-- Rich Text Editor Toolbar -->
        <div class="editor-toolbar">
          <!-- Undo/Redo -->
          <div class="toolbar-group">
            <button class="toolbar-btn" (click)="undo()" title="Ho√†n t√°c (Ctrl+Z)">
              <span class="toolbar-icon">‚Ü∂</span>
            </button>
            <button class="toolbar-btn" (click)="redo()" title="L√†m l·∫°i (Ctrl+Y)">
              <span class="toolbar-icon">‚Ü∑</span>
            </button>
          </div>

          <div class="toolbar-divider"></div>

          <!-- Format Block / Headings -->
          <div class="toolbar-group">
            <select class="toolbar-select" (change)="formatBlock($event)" title="ƒê·ªãnh d·∫°ng" #formatBlockSelect>
              <option value="p">ƒêo·∫°n vƒÉn</option>
              <option value="h1">Ti√™u ƒë·ªÅ 1</option>
              <option value="h2">Ti√™u ƒë·ªÅ 2</option>
              <option value="h3">Ti√™u ƒë·ªÅ 3</option>
              <option value="h4">Ti√™u ƒë·ªÅ 4</option>
              <option value="h5">Ti√™u ƒë·ªÅ 5</option>
              <option value="h6">Ti√™u ƒë·ªÅ 6</option>
            </select>
          </div>

          <div class="toolbar-divider"></div>

          <!-- Font Family -->
          <div class="toolbar-group">
            <select class="toolbar-select" (change)="changeFontFamily($event)" title="Ph√¥ng ch·ªØ">
              <option value="">M·∫∑c ƒë·ªãnh</option>
              <option value="Arial">Arial</option>
              <option value="Helvetica">Helvetica</option>
              <option value="Times New Roman">Times New Roman</option>
              <option value="Courier New">Courier New</option>
              <option value="Verdana">Verdana</option>
              <option value="Georgia">Georgia</option>
              <option value="Palatino">Palatino</option>
              <option value="Garamond">Garamond</option>
              <option value="Comic Sans MS">Comic Sans MS</option>
              <option value="Trebuchet MS">Trebuchet MS</option>
              <option value="Impact">Impact</option>
            </select>
          </div>

          <div class="toolbar-divider"></div>

          <!-- Font Size -->
          <div class="toolbar-group">
            <select class="toolbar-select toolbar-select-size" (change)="changeFontSize($event)" title="C·ª° ch·ªØ" #fontSizeSelect>
              <option value="1">8pt</option>
              <option value="2">10pt</option>
              <option value="3">12pt</option>
              <option value="4">14pt</option>
              <option value="5">18pt</option>
              <option value="6">24pt</option>
              <option value="7">36pt</option>
            </select>
          </div>

          <div class="toolbar-divider"></div>

          <!-- Text Formatting -->
          <div class="toolbar-group">
            <button class="toolbar-btn" (click)="execCommand('bold')" title="ƒê·∫≠m (Ctrl+B)">
              <strong>B</strong>
            </button>
            <button class="toolbar-btn" (click)="execCommand('italic')" title="Nghi√™ng (Ctrl+I)">
              <em>I</em>
            </button>
            <button class="toolbar-btn" (click)="execCommand('underline')" title="G·∫°ch ch√¢n (Ctrl+U)">
              <u>U</u>
            </button>
            <button class="toolbar-btn" (click)="execCommand('strikeThrough')" title="G·∫°ch ngang">
              <s>S</s>
            </button>
          </div>

          <div class="toolbar-divider"></div>

          <!-- Text Color & Highlight -->
          <div class="toolbar-group">
            <div class="toolbar-color-wrapper">
              <input type="color" class="toolbar-color-input" (change)="changeTextColor($event)" title="M√†u ch·ªØ" value="#000000">
              <button class="toolbar-btn toolbar-btn-color" title="M√†u ch·ªØ">
                <span class="toolbar-icon-color">A</span>
              </button>
            </div>
            <div class="toolbar-color-wrapper">
              <input type="color" class="toolbar-color-input" (change)="changeHighlightColor($event)" title="T√¥ s√°ng" value="#FFFF00">
              <button class="toolbar-btn toolbar-btn-highlight" title="T√¥ s√°ng">
                <span class="toolbar-icon-highlight">‚ñÆ</span>
              </button>
            </div>
          </div>

          <div class="toolbar-divider"></div>

          <!-- Subscript/Superscript -->
          <div class="toolbar-group">
            <button class="toolbar-btn" (click)="execCommand('subscript')" title="Ch·ªâ s·ªë d∆∞·ªõi">
              <span style="font-size: 12px; vertical-align: sub;">x<sub>2</sub></span>
            </button>
            <button class="toolbar-btn" (click)="execCommand('superscript')" title="Ch·ªâ s·ªë tr√™n">
              <span style="font-size: 12px; vertical-align: super;">x<sup>2</sup></span>
            </button>
          </div>

          <div class="toolbar-divider"></div>

          <!-- Text Alignment -->
          <div class="toolbar-group">
            <button class="toolbar-btn" (click)="execCommand('justifyLeft')" title="CƒÉn tr√°i">
              <span class="align-icon">‚¨Ö</span>
            </button>
            <button class="toolbar-btn" (click)="execCommand('justifyCenter')" title="CƒÉn gi·ªØa">
              <span class="align-icon">‚¨å</span>
            </button>
            <button class="toolbar-btn" (click)="execCommand('justifyRight')" title="CƒÉn ph·∫£i">
              <span class="align-icon">‚û°</span>
            </button>
            <button class="toolbar-btn" (click)="execCommand('justifyFull')" title="CƒÉn ƒë·ªÅu">
              <span class="align-icon">‚¨ç</span>
            </button>
          </div>

          <div class="toolbar-divider"></div>

          <!-- Line Spacing -->
          <div class="toolbar-group">
            <select class="toolbar-select toolbar-select-size" (change)="changeLineSpacing($any($event.target).value)" title="Gi√£n d√≤ng">
              <option value="1.0">1.0</option>
              <option value="1.15">1.15</option>
              <option value="1.5">1.5</option>
              <option value="2.0">2.0</option>
              <option value="2.5">2.5</option>
              <option value="3.0">3.0</option>
            </select>
          </div>

          <div class="toolbar-divider"></div>

          <!-- Lists -->
          <div class="toolbar-group">
            <button class="toolbar-btn" (click)="execCommand('insertUnorderedList')" title="Danh s√°ch d·∫•u ƒë·∫ßu d√≤ng">
              ‚ò∞
            </button>
            <button class="toolbar-btn" (click)="execCommand('insertOrderedList')" title="Danh s√°ch ƒë√°nh s·ªë">
              ‚â°
            </button>
            <button class="toolbar-btn" (click)="decreaseIndent()" title="Gi·∫£m th·ª•t l·ªÅ">
              ‚Üê
            </button>
            <button class="toolbar-btn" (click)="increaseIndent()" title="TƒÉng th·ª•t l·ªÅ">
              ‚Üí
            </button>
          </div>

          <div class="toolbar-divider"></div>

          <!-- Insert Link & Image -->
          <div class="toolbar-group">
            <button class="toolbar-btn" (click)="insertLink()" title="Ch√®n li√™n k·∫øt">
              üîó
            </button>
            <button class="toolbar-btn" (click)="insertImage()" title="Ch√®n ·∫£nh">
              üì∑
            </button>
          </div>

          <div class="toolbar-divider"></div>

          <!-- Clear Formatting -->
          <div class="toolbar-group">
            <button class="toolbar-btn" (click)="clearFormatting()" title="X√≥a ƒë·ªãnh d·∫°ng">
              <span class="toolbar-icon">‚å´</span>
            </button>
          </div>
        </div>
        
        <div 
          class="content-editor" 
          contenteditable="true"
          (blur)="updateBlogContent($event)"
          #contentEditor
        ></div>
      </div>
    </div>

    <!-- Edit Popup Modal -->
    <div class="edit-popup-overlay" *ngIf="showEditPopup" (click)="closeEditPopup()">
      <div class="edit-popup-modal" (click)="$event.stopPropagation()">
        <div class="popup-header">
          <h2 class="popup-title" *ngIf="!isNewBlog">Ch·ªânh s·ª≠a th√¥ng tin b√†i vi·∫øt</h2>
          <h2 class="popup-title" *ngIf="isNewBlog">Th√™m b√†i vi·∫øt m·ªõi</h2>
          <button class="popup-close-btn" (click)="closeEditPopup()">
            <img src="/asset/icons/clear_dark.png" alt="Close">
          </button>
        </div>

        <div class="popup-content" *ngIf="currentBlog">
          <div class="form-group-inline">
            <label class="form-label-inline">Ti√™u ƒë·ªÅ b√†i vi·∫øt:</label>
            <input 
              type="text" 
              class="form-input-dark" 
              [(ngModel)]="currentBlog.title"
              placeholder="Nh·∫≠p ti√™u ƒë·ªÅ b√†i vi·∫øt"
            >
          </div>
          
          <div class="form-group-inline">
            <label class="form-label-inline">ID/M√£ b√†i vi·∫øt:</label>
            <input 
              type="text" 
              class="form-input-dark" 
              [(ngModel)]="currentBlog.blog_id"
              placeholder="M√£ b√†i vi·∫øt"
              [readonly]="!isNewBlog"
            >
          </div>
          
          <div class="form-group-inline">
            <label class="form-label-inline">T√°c gi·∫£:</label>
            <input 
              type="text" 
              class="form-input-dark" 
              [(ngModel)]="currentBlog.author"
              placeholder="Nh·∫≠p t√™n t√°c gi·∫£"
            >
          </div>
          
          <div class="form-group-inline">
            <label class="form-label-inline">Email:</label>
            <input 
              type="email" 
              class="form-input-dark" 
              [(ngModel)]="currentBlog.email"
              placeholder="nh·∫≠p email"
            >
          </div>
          
          <div class="form-group-inline">
            <label class="form-label-inline">Ng√†y t·∫°o:</label>
            <div class="input-with-icon date-picker-container">
              <input 
                type="text" 
                class="form-input-dark" 
                [(ngModel)]="currentBlog.created_date"
                placeholder="DD/MM/YYYY"
                readonly
              >
              <img 
                src="/asset/icons/calender_dark.png" 
                alt="Calendar" 
                class="input-icon" 
                (click)="openDatePicker()"
                style="cursor: pointer;"
              >
              <!-- Date Picker -->
              <div class="date-picker-dropdown" *ngIf="showDatePicker" (click)="$event.stopPropagation()">
                <div class="date-picker-header">
                  <button type="button" class="date-picker-nav" (click)="previousMonth()">‚Äπ</button>
                  <div class="date-picker-month-year">
                    {{ getMonthName(selectedDate.getMonth()) }} {{ selectedDate.getFullYear() }}
                  </div>
                  <button type="button" class="date-picker-nav" (click)="nextMonth()">‚Ä∫</button>
                </div>
                <div class="date-picker-weekdays">
                  <div class="date-picker-weekday" *ngFor="let day of getDayNames()">{{ day }}</div>
                </div>
                <div class="date-picker-days">
                  <div 
                    class="date-picker-day" 
                    *ngFor="let date of getDatePickerDates()"
                    [class.today]="isToday(date)"
                    [class.selected]="isSelectedDate(date)"
                    [class.other-month]="!isCurrentMonth(date)"
                    (click)="selectDate(date)"
                  >
                    {{ date.getDate() }}
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="form-group-inline">
            <label class="form-label-inline">Category:</label>
            <div class="select-wrapper">
              <select class="form-select-dark" [(ngModel)]="currentBlog.category">
                <option *ngFor="let cat of blogCategories" [value]="cat">{{ cat }}</option>
              </select>
              <img src="/asset/icons/arrowdown.png" alt="Dropdown" class="select-icon">
            </div>
          </div>

        </div>

        <div class="popup-footer">
          <button class="btn-popup-cancel" (click)="closeEditPopup()">H·ªßy</button>
          <button class="btn-popup-save" (click)="saveFromPopup()">{{ isNewBlog ? 'Th√™m b√†i vi·∫øt' : 'L∆∞u thay ƒë·ªïi' }}</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirmation Dialog -->
  <div class="popup-overlay" *ngIf="showConfirmDialog" (click)="cancelDelete()">
    <div class="confirm-dialog" (click)="$event.stopPropagation()">
      <div class="confirm-icon">
        <span class="icon-question">?</span>
      </div>
      <div class="confirm-message">{{ confirmMessage }}</div>
      <div class="confirm-buttons">
        <button class="btn-confirm-cancel" (click)="cancelDelete()">H·ªßy</button>
        <button class="btn-confirm-ok" (click)="confirmDelete()">X√°c nh·∫≠n</button>
      </div>
    </div>
  </div>

  <!-- Custom Popup Notification -->
  <div class="popup-overlay" *ngIf="showPopup" (click)="closePopup()">
    <div class="popup-container" (click)="$event.stopPropagation()">
      <div class="popup-icon" [class.success]="popupType === 'success'" [class.error]="popupType === 'error'" [class.info]="popupType === 'info'">
        <span class="icon-check" *ngIf="popupType === 'success'">‚úì</span>
        <span class="icon-error" *ngIf="popupType === 'error'">‚úï</span>
        <span class="icon-info" *ngIf="popupType === 'info'">i</span>
      </div>
      <div class="popup-message">{{ popupMessage }}</div>
      <button class="popup-btn-ok" (click)="closePopup()">OK</button>
    </div>
  </div>
</div>
