<!-- Products Management Page -->
<div class="products-page" (click)="closeDropdowns($event)">
  <!-- Breadcrumb -->
  <div class="breadcrumb">
    <span>Qu·∫£n tr·ªã vi√™n</span>
    <span class="separator">/</span>
    <span>Qu·∫£n l√Ω s·∫£n ph·∫©m</span>
    <span class="separator">/</span>
    <span class="current">Danh s√°ch s·∫£n ph·∫©m</span>
  </div>

  <!-- Page Header -->
  <div class="page-header">
    <div class="page-title-section">
      <h1 class="page-title">DANH S√ÅCH S·∫¢N PH·∫®M</h1>
      <p class="products-info" *ngIf="!isLoading && products.length > 0">
        Hi·ªÉn th·ªã <strong>{{products.length}}</strong> s·∫£n ph·∫©m
      </p>
    </div>
    <button class="btn-add-product" (click)="addProduct()">
      <img src="/asset/icons/plus.png" alt="Add">
      <span>Th√™m s·∫£n ph·∫©m</span>
    </button>
  </div>

  <!-- Toolbar -->
  <div class="toolbar">
    <!-- Actions -->
    <div class="actions-container">
      <!-- Search Container -->
      <div class="search-container">
        <input type="text" class="search-input" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..." (input)="searchProducts($event)">
        <button class="search-btn">
          <img src="/asset/icons/search_dark.png" alt="Search">
        </button>
      </div>
      
      <span class="selected-count">{{selectedCount}} ƒë√£ ch·ªçn</span>
      
      <button class="btn-action btn-edit" (click)="editProducts()" [disabled]="selectedCount !== 1">
        <img src="/asset/icons/edit_dark.png" alt="Edit">
        <span>Ch·ªânh</span>
      </button>
      
      <button 
        class="btn-action btn-delete" 
        [class.disabled]="selectedCount === 0"
        [disabled]="selectedCount === 0"
        (click)="deleteProducts(); $event.stopPropagation(); $event.preventDefault()" 
        type="button">
        <img src="/asset/icons/trash_red.png" alt="Delete">
        <span>Xo√°</span>
      </button>
      
      <button class="btn-action btn-group" (click)="openGroupModal()" [disabled]="selectedCount < 2">
        <img src="/asset/icons/group.png" alt="Group">
        <span>Nh√≥m</span>
      </button>
      
      <!-- Filter Dropdown -->
        <div class="dropdown-container">
          <button class="btn-action btn-filter" [class.active]="showFilterDropdown" (click)="toggleFilterDropdown($event)">
            <img src="/asset/icons/filter_dark.png" alt="Filter">
            <span>L·ªçc {{showFilterDropdown ? '‚úì' : ''}}</span>
            <span class="dropdown-arrow">‚ñº</span>
          </button>
          <div class="dropdown-menu dropdown-menu-multilevel" *ngIf="showFilterDropdown" (click)="$event.stopPropagation()">
            <!-- Stock Status with Submenu -->
            <div class="dropdown-item-parent">
              <div class="dropdown-item">
                <img src="/asset/icons/storage.png" alt="Stock" class="item-icon">
                <span>T·ªìn kho</span>
                <span class="arrow-right">‚Ä∫</span>
              </div>
              <div class="dropdown-submenu">
                <label class="dropdown-option" (click)="toggleStockFilter('in-stock')">
                  <input type="checkbox" [checked]="currentFilters.stockStatus === 'in-stock'" (click)="$event.stopPropagation()">
                  <span>C√≤n h√†ng</span>
                </label>
                <label class="dropdown-option" (click)="toggleStockFilter('low-stock')">
                  <input type="checkbox" [checked]="currentFilters.stockStatus === 'low-stock'" (click)="$event.stopPropagation()">
                  <span>S·∫Øp h·∫øt (&lt;10)</span>
                </label>
                <label class="dropdown-option" (click)="toggleStockFilter('out-of-stock')">
                  <input type="checkbox" [checked]="currentFilters.stockStatus === 'out-of-stock'" (click)="$event.stopPropagation()">
                  <span>H·∫øt h√†ng</span>
                </label>
              </div>
            </div>
            
            <!-- Rating with Submenu -->
            <div class="dropdown-item-parent">
              <div class="dropdown-item">
                <img src="/asset/icons/star_dark.png" alt="Rating" class="item-icon">
                <span>ƒê√°nh gi√°</span>
                <span class="arrow-right">‚Ä∫</span>
              </div>
              <div class="dropdown-submenu">
                <label class="dropdown-option" *ngFor="let rating of [5, 4, 3, 2, 1]" (click)="toggleRatingFilter(rating)">
                  <input type="checkbox" [checked]="currentFilters.rating === rating" (click)="$event.stopPropagation()">
                  <span>{{rating}} ‚≠ê</span>
                </label>
              </div>
            </div>
            
            <!-- Category with Submenu -->
            <div class="dropdown-item-parent" *ngIf="availableCategories.length > 0">
              <div class="dropdown-item">
                <img src="/asset/icons/category.png" alt="Category" class="item-icon">
                <span>Ph√¢n lo·∫°i</span>
                <span class="arrow-right">‚Ä∫</span>
              </div>
              <div class="dropdown-submenu dropdown-submenu-scrollable">
                <label class="dropdown-option" *ngFor="let cat of availableCategories" (click)="toggleCategoryFilter(cat)">
                  <input type="checkbox" [checked]="currentFilters.category === cat" (click)="$event.stopPropagation()">
                  <span>{{cat}}</span>
                </label>
              </div>
            </div>
            
            <!-- Group with Submenu -->
            <div class="dropdown-item-parent">
              <div class="dropdown-item">
                <img src="/asset/icons/group.png" alt="Group" class="item-icon">
                <span>Nh√≥m s·∫£n ph·∫©m</span>
                <span class="arrow-right">‚Ä∫</span>
              </div>
              <div class="dropdown-submenu dropdown-submenu-scrollable" *ngIf="allGroupNames.length > 0">
                <label class="dropdown-option" *ngFor="let groupName of allGroupNames" (click)="toggleGroupFilter(groupName)">
                  <input type="checkbox" [checked]="currentFilters.group === groupName" (click)="$event.stopPropagation()">
                  <span>{{groupName}}</span>
                </label>
              </div>
              <div class="dropdown-submenu" *ngIf="allGroupNames.length === 0">
                <div class="dropdown-empty">
                  <img src="/asset/icons/group.png" alt="Group" class="empty-icon" style="width: 20px; height: 20px;">
                  <span>Ch∆∞a c√≥ nh√≥m n√†o</span>
                </div>
              </div>
            </div>
            
            <div class="dropdown-divider"></div>
            <div class="dropdown-actions">
              <button class="btn-clear-filter" (click)="clearFilters()">
                <img src="/asset/icons/trash_red.png" alt="Clear Filter" style="width: 16px; height: 16px;">
                <span>X√≥a b·ªô l·ªçc</span>
              </button>
            </div>
          </div>
        </div>
        
        <!-- Sort Dropdown -->
        <div class="dropdown-container">
          <button class="btn-action btn-sort" [class.active]="showSortDropdown" (click)="toggleSortDropdown($event)">
            <span class="icon-sort">‚áÖ</span>
            <span>S·∫Øp x·∫øp {{showSortDropdown ? '‚úì' : ''}}</span>
            <span class="dropdown-arrow">‚ñº</span>
          </button>
          <div class="dropdown-menu dropdown-menu-sort" *ngIf="showSortDropdown" (click)="$event.stopPropagation()">
            <!-- Sort by Name -->
            <div class="sort-option" 
                 [class.active]="currentSortField === 'name'" 
                 (click)="sortBy('name')">
              <div class="sort-option-icon">
                <img src="/asset/icons/name.png" alt="Name" style="width: 24px; height: 24px;">
              </div>
              <div class="sort-option-content">
                <div class="sort-option-label">T√™n s·∫£n ph·∫©m</div>
                <div class="sort-option-desc">A ‚Üí Z ho·∫∑c Z ‚Üí A</div>
              </div>
              <div class="sort-option-indicator" *ngIf="currentSortField === 'name'">
                <div class="indicator-badge" [class.asc]="currentSortOrder === 'asc'" [class.desc]="currentSortOrder === 'desc'">
                  {{currentSortOrder === 'asc' ? 'A‚ÜíZ' : 'Z‚ÜíA'}}
                </div>
              </div>
            </div>

            <!-- Sort by Price -->
            <div class="sort-option" 
                 [class.active]="currentSortField === 'price'" 
                 (click)="sortBy('price')">
              <div class="sort-option-icon">
                <img src="/asset/icons/price.png" alt="Price" style="width: 24px; height: 24px;">
              </div>
              <div class="sort-option-content">
                <div class="sort-option-label">Gi√°</div>
                <div class="sort-option-desc">Th·∫•p ƒë·∫øn cao / Cao ƒë·∫øn th·∫•p</div>
              </div>
              <div class="sort-option-indicator" *ngIf="currentSortField === 'price'">
                <div class="indicator-badge" [class.asc]="currentSortOrder === 'asc'" [class.desc]="currentSortOrder === 'desc'">
                  {{currentSortOrder === 'asc' ? '‚Üë' : '‚Üì'}}
                </div>
              </div>
            </div>

            <!-- Sort by Stock -->
            <div class="sort-option" 
                 [class.active]="currentSortField === 'stock'" 
                 (click)="sortBy('stock')">
              <div class="sort-option-icon">
                <img src="/asset/icons/storage.png" alt="Stock" style="width: 24px; height: 24px;">
              </div>
              <div class="sort-option-content">
                <div class="sort-option-label">T·ªìn kho</div>
                <div class="sort-option-desc">√çt ƒë·∫øn nhi·ªÅu / Nhi·ªÅu ƒë·∫øn √≠t</div>
              </div>
              <div class="sort-option-indicator" *ngIf="currentSortField === 'stock'">
                <div class="indicator-badge" [class.asc]="currentSortOrder === 'asc'" [class.desc]="currentSortOrder === 'desc'">
                  {{currentSortOrder === 'asc' ? '‚Üë' : '‚Üì'}}
                </div>
              </div>
            </div>

            <!-- Sort by Rating -->
            <div class="sort-option" 
                 [class.active]="currentSortField === 'rating'" 
                 (click)="sortBy('rating')">
              <div class="sort-option-icon">
                <img src="/asset/icons/star_dark.png" alt="Rating" style="width: 24px; height: 24px;">
              </div>
              <div class="sort-option-content">
                <div class="sort-option-label">ƒê√°nh gi√°</div>
                <div class="sort-option-desc">Th·∫•p ƒë·∫øn cao / Cao ƒë·∫øn th·∫•p</div>
              </div>
              <div class="sort-option-indicator" *ngIf="currentSortField === 'rating'">
                <div class="indicator-badge" [class.asc]="currentSortOrder === 'asc'" [class.desc]="currentSortOrder === 'desc'">
                  {{currentSortOrder === 'asc' ? '‚Üë' : '‚Üì'}}
                </div>
              </div>
            </div>

            <!-- Sort by Updated Date -->
            <div class="sort-option" 
                 [class.active]="currentSortField === 'updated'" 
                 (click)="sortBy('updated')">
              <div class="sort-option-icon">
                <img src="/asset/icons/calendar.png" alt="Calendar" style="width: 24px; height: 24px;">
              </div>
              <div class="sort-option-content">
                <div class="sort-option-label">Ng√†y c·∫≠p nh·∫≠t</div>
                <div class="sort-option-desc">C≈© ƒë·∫øn m·ªõi / M·ªõi ƒë·∫øn c≈©</div>
              </div>
              <div class="sort-option-indicator" *ngIf="currentSortField === 'updated'">
                <div class="indicator-badge" [class.asc]="currentSortOrder === 'asc'" [class.desc]="currentSortOrder === 'desc'">
                  {{currentSortOrder === 'asc' ? '‚Üë' : '‚Üì'}}
                </div>
              </div>
            </div>
          </div>
        </div>
    </div>
  </div>


  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="loading-spinner"></div>
    <p>ƒêang t·∫£i d·ªØ li·ªáu s·∫£n ph·∫©m...</p>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="loadError">
    <p class="error-message">{{loadError}}</p>
    <button class="btn-retry" (click)="loadProducts()">Th·ª≠ l·∫°i</button>
  </div>

  <!-- Products Table -->
  <div class="products-table-container" *ngIf="!isLoading && !loadError">
    <table class="products-table">
      <thead>
        <tr>
          <th class="col-checkbox">
            <input type="checkbox" class="checkbox-all" [checked]="selectAll" (change)="toggleSelectAll()">
          </th>
          <th class="col-name">T√™n s·∫£n ph·∫©m</th>
          <th class="col-unit">ƒê∆°n v·ªã t√≠nh</th>
          <th class="col-stock">T·ªìn kho</th>
          <th class="col-category">Ph√¢n lo·∫°i</th>
          <th class="col-groups">Gi√° b√°n</th>
          <th class="col-rating">ƒê√°nh gi√°</th>
          <th class="col-updated">C·∫≠p nh·∫≠t g·∫ßn nh·∫•t</th>
        </tr>
      </thead>
      <tbody>
        <!-- No Products Message -->
        <tr *ngIf="products.length === 0">
          <td colspan="8" class="no-products">
            <p>Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o</p>
          </td>
        </tr>
        
        <!-- Dynamic Product Rows -->
        <tr class="product-row" *ngFor="let product of products" [class.selected]="product.selected">
          <td class="col-checkbox" (click)="$event.stopPropagation()">
            <input type="checkbox" class="checkbox-item" [checked]="product.selected" (change)="toggleProduct(product)">
          </td>
          <td class="col-name clickable" (click)="viewProductDetail(product)">
            <div class="product-info">
              <div class="product-image">
                <img [src]="product.image || '/asset/icons/shop.png'" 
                     [alt]="product.name"
                     (error)="$any($event.target).src='/asset/icons/shop.png'">
              </div>
              <div class="product-details">
                <div class="product-name">{{product.name}}</div>
                <div class="product-code">{{product.sku}}</div>
              </div>
            </div>
          </td>
          <td class="col-unit">{{product.unit}}</td>
          <td class="col-stock" [ngClass]="getStockClass(product.stock)">
            {{product.stock === 0 ? 'xxx' : product.stock}}
          </td>
          <td class="col-category">{{product.category}}</td>
          <td class="col-groups">{{formatCurrency(product.price)}}</td>
          <td class="col-rating">
            <div class="rating">
              <span *ngFor="let starType of getStarArray(product.rating || 0)" 
                    class="star" 
                    [class.star-full]="starType === 'full'"
                    [class.star-half]="starType === 'half'"
                    [class.star-empty]="starType === 'empty'">‚òÖ</span>
            </div>
            <div class="rating-value">{{product.rating || 0}}</div>
          </td>
          <td class="col-updated">{{product.updated}}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Product Form Modal -->
<div class="product-modal-overlay" 
     *ngIf="showProductForm" 
     [class.sidebar-collapsed]="isSidebarCollapsed"
     (click)="closeProductForm()">
  <div class="product-modal-content" (click)="$event.stopPropagation()">
    <!-- Modal Header -->
    <div class="modal-header">
      <div class="modal-title-section">
        <button class="btn-back" (click)="closeProductForm()">
          <img src="/asset/icons/arrowleft_dark.png" alt="Back">
          <span>Quay l·∫°i trang s·∫£n ph·∫©m</span>
        </button>
        <h2 class="modal-title">{{currentProduct.name ? currentProduct.name.toUpperCase() : ''}}</h2>
      </div>
    </div>

    <!-- Modal Body -->
    <div class="modal-body">
      <form class="product-form">
        <!-- T√™n s·∫£n ph·∫©m -->
        <div class="form-group full-width">
          <label class="form-label">T√™n s·∫£n ph·∫©m:</label>
          <input type="text" class="form-input" placeholder="T√™n s·∫£n ph·∫©m" [(ngModel)]="currentProduct.name" (ngModelChange)="onFieldChange('name', $event)" name="name">
        </div>

        <!-- M√£ s·∫£n ph·∫©m & SKU -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">M√£ s·∫£n ph·∫©m</label>
            <input type="text" class="form-input" placeholder="M√£ s·∫£n ph·∫©m" [(ngModel)]="currentProduct.code" (ngModelChange)="onFieldChange('code', $event)" name="code">
          </div>
          <div class="form-group">
            <label class="form-label">SKU:</label>
            <input type="text" class="form-input" placeholder="SKU" [(ngModel)]="currentProduct.sku" (ngModelChange)="onFieldChange('sku', $event)" name="sku">
          </div>
        </div>

        <!-- Th∆∞∆°ng hi·ªáu & Ph√¢n lo·∫°i -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Th∆∞∆°ng hi·ªáu:</label>
            <input type="text" class="form-input" placeholder="Th∆∞∆°ng hi·ªáu" [(ngModel)]="currentProduct.brand" (ngModelChange)="onFieldChange('brand', $event)" name="brand">
          </div>
          <div class="form-group">
            <label class="form-label">Ph√¢n lo·∫°i:</label>
            <div class="form-select-wrapper">
              <select 
                class="form-select" 
                [(ngModel)]="currentProduct.category" 
                (ngModelChange)="onCategoryChange($event); onFieldChange('category', $event)" 
                name="category">
                <option value="">Ch·ªçn ph√¢n lo·∫°i...</option>
                <option *ngFor="let cat of availableCategories" [value]="cat">{{cat}}</option>
              </select>
              <img src="/asset/icons/arrowdown.png" alt="Dropdown" class="select-icon">
            </div>
          </div>
        </div>

        <!-- Ph√¢n lo·∫°i ph·ª• & Xu·∫•t x·ª© -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Ph√¢n lo·∫°i ph·ª•:</label>
            <div class="form-select-wrapper">
              <select 
                class="form-select" 
                [(ngModel)]="currentProduct.subcategory" 
                (ngModelChange)="onFieldChange('subcategory', $event)" 
                name="subcategory"
                [disabled]="!currentProduct.category || formSubcategories.length === 0">
                <option value="">Ch·ªçn ph√¢n lo·∫°i ph·ª•...</option>
                <option *ngFor="let subcat of formSubcategories" [value]="subcat">{{subcat}}</option>
              </select>
              <img src="/asset/icons/arrowdown.png" alt="Dropdown" class="select-icon">
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Xu·∫•t x·ª©:</label>
            <input type="text" class="form-input" placeholder="Xu·∫•t x·ª©" [(ngModel)]="currentProduct.origin" (ngModelChange)="onFieldChange('origin', $event)" name="origin">
          </div>
        </div>

        <!-- Kh·ªëi l∆∞·ª£ng & ƒê∆°n v·ªã t√≠nh -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Kh·ªëi l∆∞·ª£ng:</label>
            <input type="text" class="form-input" placeholder="Kh·ªëi l∆∞·ª£ng" [(ngModel)]="currentProduct.weight" (ngModelChange)="onFieldChange('weight', $event)" name="weight">
          </div>
          <div class="form-group">
            <label class="form-label">ƒê∆°n v·ªã t√≠nh:</label>
            <input type="text" class="form-input" placeholder="ƒê∆°n v·ªã t√≠nh" [(ngModel)]="currentProduct.unit" (ngModelChange)="onFieldChange('unit', $event)" name="unit">
          </div>
        </div>

        <!-- T·ªìn kho -->
        <div class="form-group full-width">
          <label class="form-label">T·ªìn kho:</label>
          <input type="number" class="form-input" placeholder="xxx" [(ngModel)]="currentProduct.stock" (ngModelChange)="onFieldChange('stock', $event)" name="stock">
        </div>

        <!-- Th·ªëng k√™ s·∫£n ph·∫©m -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">L∆∞·ª£t mua:</label>
            <input type="number" class="form-input" [value]="currentProduct.PurchaseCount || 0" readonly disabled>
          </div>
          <div class="form-group">
            <label class="form-label">L∆∞·ª£t like:</label>
            <input type="number" class="form-input" [value]="currentProduct.liked || 0" readonly disabled>
          </div>
          <div class="form-group">
            <label class="form-label">L∆∞·ª£t ƒë√°nh gi√°:</label>
            <input type="number" class="form-input" [value]="currentProduct.reviewCount || 0" readonly disabled>
          </div>
        </div>

        <!-- Th√†nh ph·∫ßn -->
        <div class="form-group full-width">
          <label class="form-label">Th√†nh ph·∫ßn:</label>
          <textarea class="form-textarea" placeholder="Th√†nh ph·∫ßn" rows="3" [(ngModel)]="currentProduct.ingredients" (ngModelChange)="onFieldChange('ingredients', $event)" name="ingredients"></textarea>
        </div>

        <!-- H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng -->
        <div class="form-group full-width">
          <label class="form-label">H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng:</label>
          <textarea class="form-textarea" placeholder="H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng" rows="4" [(ngModel)]="currentProduct.usage" (ngModelChange)="onFieldChange('usage', $event)" name="usage"></textarea>
        </div>

        <!-- B·∫£o qu·∫£n -->
        <div class="form-group full-width">
          <label class="form-label">B·∫£o qu·∫£n:</label>
          <textarea class="form-textarea" placeholder="B·∫£o qu·∫£n" rows="2" [(ngModel)]="currentProduct.storage" (ngModelChange)="onFieldChange('storage', $event)" name="storage"></textarea>
        </div>

        <!-- M√†u s·∫Øc -->
        <div class="form-group full-width">
          <label class="form-label">Ph√¢n lo·∫°i m√†u s·∫Øc:</label>
          <div class="form-select-wrapper">
            <select 
              class="form-select" 
              [(ngModel)]="currentProduct.color" 
              (ngModelChange)="onFieldChange('color', $event)" 
              name="color">
              <option value="">Ch·ªçn m√†u s·∫Øc...</option>
              <option *ngFor="let color of availableColors" [value]="color">{{color}}</option>
            </select>
            <img src="/asset/icons/arrowdown.png" alt="Dropdown" class="select-icon">
          </div>
        </div>

        <!-- Nh√† s·∫£n xu·∫•t & T·ªï ch·ª©c ch·ªãu tr√°ch nhi·ªám -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Nh√† s·∫£n xu·∫•t:</label>
            <input type="text" class="form-input" placeholder="Nh√† s·∫£n xu·∫•t" [(ngModel)]="currentProduct.producer" (ngModelChange)="onFieldChange('producer', $event)" name="producer">
          </div>
          <div class="form-group">
            <label class="form-label">T·ªï ch·ª©c ch·ªãu tr√°ch nhi·ªám:</label>
            <input type="text" class="form-input" placeholder="T·ªï ch·ª©c ch·ªãu tr√°ch nhi·ªám" [(ngModel)]="currentProduct.responsibleOrg" (ngModelChange)="onFieldChange('responsibleOrg', $event)" name="responsibleOrg">
          </div>
        </div>

        <!-- Ng√†y s·∫£n xu·∫•t & H·∫°n s·ª≠ d·ª•ng -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Ng√†y s·∫£n xu·∫•t:</label>
            <input type="text" class="form-input" placeholder="Ng√†y s·∫£n xu·∫•t" [(ngModel)]="currentProduct.manufactureDate" (ngModelChange)="onFieldChange('manufactureDate', $event)" name="manufactureDate">
          </div>
          <div class="form-group">
            <label class="form-label">H·∫°n s·ª≠ d·ª•ng:</label>
            <input type="text" class="form-input" placeholder="H·∫°n s·ª≠ d·ª•ng" [(ngModel)]="currentProduct.expiryDate" (ngModelChange)="onFieldChange('expiryDate', $event)" name="expiryDate">
          </div>
        </div>

        <!-- C·∫£nh b√°o an to√†n -->
        <div class="form-group full-width">
          <label class="form-label">C·∫£nh b√°o an to√†n:</label>
          <textarea class="form-textarea" placeholder="C·∫£nh b√°o an to√†n" rows="2" [(ngModel)]="currentProduct.safetyWarning" (ngModelChange)="onFieldChange('safetyWarning', $event)" name="safetyWarning"></textarea>
        </div>

        <!-- Nh√≥m s·∫£n ph·∫©m -->
        <div class="form-group full-width">
          <label class="form-label">Nh√≥m s·∫£n ph·∫©m:</label>
          
          <!-- Current Groups -->
          <div class="groups-container" *ngIf="currentProduct.groups && currentProduct.groups.length > 0">
            <div class="group-tag" *ngFor="let group of currentProduct.groups">
              <img src="/asset/icons/group.png" alt="Group" class="group-icon" style="width: 16px; height: 16px;">
              <span class="group-name">{{group}}</span>
              <button type="button" class="group-remove" (click)="removeGroupFromProduct(group)">√ó</button>
            </div>
          </div>
          
          <!-- Select Group Dropdown -->
          <div class="group-select-container" *ngIf="allGroupNames.length > 0">
            <select 
              class="form-select group-select" 
              [(ngModel)]="selectedGroupToAdd" 
              name="groupSelect"
              (change)="addSelectedGroup()">
              <option value="" disabled selected>Ch·ªçn nh√≥m ƒë·ªÉ th√™m v√†o s·∫£n ph·∫©m...</option>
              <option 
                *ngFor="let groupName of allGroupNames" 
                [value]="groupName"
                [disabled]="currentProduct.groups?.includes(groupName)">
                üìÅ {{groupName}}
              </option>
            </select>
          </div>
          
          <!-- Empty State -->
          <div class="group-empty-state" *ngIf="allGroupNames.length === 0">
            <p class="empty-state-text">
              <img src="/asset/icons/group.png" alt="Group" class="empty-icon" style="width: 20px; height: 20px;">
              Ch∆∞a c√≥ nh√≥m n√†o. H√£y ch·ªçn nhi·ªÅu s·∫£n ph·∫©m v√† d√πng ch·ª©c nƒÉng "Nh√≥m" ƒë·ªÉ t·∫°o nh√≥m m·ªõi.
            </p>
          </div>
        </div>

        <!-- H√¨nh ·∫£nh -->
        <div class="form-group full-width">
          <label class="form-label">H√¨nh ·∫£nh:</label>
          <div class="image-upload-grid">
            <div class="image-upload-box" *ngFor="let img of getProductImages(); let i = index">
              <input type="file" [id]="'file-upload-' + i" class="file-input" accept="image/*" (change)="onImageSelect($event, i)">
              <label [for]="'file-upload-' + i" class="upload-label">
                <img *ngIf="img" [src]="img" [alt]="'Product image ' + (i + 1)" class="product-image-preview" (error)="handleImageError($event)">
                <img *ngIf="!img" src="/asset/icons/camera_dark.png" alt="Upload" class="upload-icon">
              </label>
              <button *ngIf="img" type="button" class="remove-image-btn" (click)="removeImage(i)" title="X√≥a h√¨nh ·∫£nh">√ó</button>
            </div>
          </div>
        </div>

        <!-- B·∫£ng gi√° -->
        <div class="form-group full-width">
          <div class="price-table">
            <div class="price-header">
              <div class="price-cell">Gi√° g·ªëc</div>
              <div class="price-cell">Gi√° b√°n</div>
              <div class="price-cell">Gi√° khuy·∫øn m√£i</div>
            </div>
            <div class="price-body">
              <div class="price-cell">
                <input type="number" class="price-input" placeholder="0" [(ngModel)]="currentProduct.originalPrice" (ngModelChange)="onFieldChange('originalPrice', $event)" name="originalPrice">
              </div>
              <div class="price-cell">
                <input type="number" class="price-input" placeholder="0" [(ngModel)]="currentProduct.price" (ngModelChange)="onFieldChange('price', $event)" name="price">
              </div>
              <div class="price-cell">
                <input type="number" class="price-input" placeholder="0" [(ngModel)]="currentProduct.salePrice" name="salePrice">
              </div>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="closeProductForm()">H·ª¶Y</button>
          <button type="button" class="btn-save" (click)="saveProduct()">L∆ØU</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Group Modal -->
<div class="group-modal-overlay" *ngIf="showGroupModal" (click)="closeGroupModal()">
  <div class="group-modal-content" (click)="$event.stopPropagation()">
    <div class="group-modal-header">
      <h3 class="group-modal-title">
        <img src="/asset/icons/group.png" alt="Group" class="title-icon" style="width: 20px; height: 20px;">
        T·∫°o nh√≥m s·∫£n ph·∫©m
      </h3>
      <button class="btn-close-modal" (click)="closeGroupModal()">√ó</button>
    </div>

    <div class="group-modal-body">
      <p class="group-modal-desc">
        B·∫°n ƒëang nh√≥m <strong>{{selectedCount}}</strong> s·∫£n ph·∫©m ƒë√£ ch·ªçn
      </p>

      <div class="group-form-group">
        <label class="group-label">T√™n nh√≥m:</label>
        <input 
          type="text" 
          class="group-name-input" 
          placeholder="VD: S·∫£n ph·∫©m khuy·∫øn m√£i, H√†ng m·ªõi v·ªÅ..." 
          [(ngModel)]="newGroupName"
          (keyup.enter)="createGroup()"
          autofocus>
      </div>

      <div class="group-info">
        <span class="info-icon">‚ÑπÔ∏è</span>
        <span>M·ªói s·∫£n ph·∫©m c√≥ th·ªÉ thu·ªôc nhi·ªÅu nh√≥m kh√°c nhau</span>
      </div>
    </div>

    <div class="group-modal-footer">
      <button class="btn-cancel-group" (click)="closeGroupModal()">H·ªßy</button>
      <button class="btn-create-group" (click)="createGroup()">
        <span>‚úì</span> T·∫°o nh√≥m
      </button>
    </div>
  </div>
</div>

<!-- Popup Notification -->
<div class="popup-overlay" *ngIf="showPopup" (click)="closePopup()">
  <div class="popup-container" (click)="$event.stopPropagation()">
    <div class="popup-content" [ngClass]="'popup-' + popupType">
      <div class="popup-icon">
        <span *ngIf="popupType === 'success'">‚úì</span>
        <span *ngIf="popupType === 'error'">‚úó</span>
        <span *ngIf="popupType === 'info'">‚Ñπ</span>
      </div>
      <div class="popup-message">{{popupMessage}}</div>
      <button class="popup-close" (click)="closePopup()">√ó</button>
    </div>
  </div>
</div>

<!-- Confirmation Dialog -->
<div class="popup-overlay" *ngIf="showConfirmDialog" (click)="cancelDelete()">
  <div class="confirm-dialog" (click)="$event.stopPropagation()">
    <div class="confirm-icon">
      <span class="icon-question">?</span>
    </div>
    <div class="confirm-message">{{ confirmMessage }}</div>
    <div class="confirm-buttons">
      <button class="btn-confirm-cancel" (click)="cancelDelete()">H·ªßy</button>
      <button class="btn-confirm-ok" (click)="confirmDelete()">OK</button>
    </div>
  </div>
</div>

<!-- Order Warning Dialog -->
<div class="popup-overlay" *ngIf="showOrderWarningDialog" (click)="cancelOrderWarning()">
  <div class="confirm-dialog order-warning-dialog" (click)="$event.stopPropagation()">
    <div class="confirm-icon warning-icon">
      <span class="icon-warning">‚ö†</span>
    </div>
    <div class="confirm-message">{{ orderWarningMessage }}</div>
    
    <div class="affected-orders-list" *ngIf="affectedOrders.length > 0">
      <div class="orders-header">C√°c ƒë∆°n h√†ng s·∫Ω b·ªã ·∫£nh h∆∞·ªüng (s·∫£n ph·∫©m s·∫Ω b·ªã x√≥a kh·ªèi ƒë∆°n h√†ng):</div>
      <div class="orders-list">
        <div class="order-item" *ngFor="let order of affectedOrders">
          <span class="order-id">#{{ order.OrderID }}</span>
          <span class="order-customer">Kh√°ch h√†ng: {{ order.CustomerID }}</span>
          <span class="order-amount">{{ order.totalAmount | number }}‚Ç´</span>
        </div>
      </div>
    </div>

    <div class="pending-products-list" *ngIf="pendingDeleteProducts.length > 0">
      <div class="products-header">S·∫£n ph·∫©m s·∫Ω b·ªã x√≥a:</div>
      <div class="products-list">
        <div class="product-item" *ngFor="let product of pendingDeleteProducts">
          {{ product.productName }}
        </div>
      </div>
    </div>

    <div class="confirm-buttons">
      <button class="btn-confirm-cancel" (click)="cancelOrderWarning()">H·ªßy</button>
      <button class="btn-confirm-ok btn-warning" (click)="confirmOrderWarning()">X√°c nh·∫≠n x√≥a</button>
    </div>
  </div>
</div>

