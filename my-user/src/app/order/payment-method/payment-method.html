<!-- Modal Overlay -->
<div class="modal-overlay" (click)="onClose()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <!-- Modal Header -->
    <div class="modal-header">
      <h2>Ph∆∞∆°ng th·ª©c thanh to√°n</h2>
      <button class="close-btn" (click)="onClose()" aria-label="ƒê√≥ng">
        <span>&times;</span>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="modal-body">
      <!-- Payment Method Selection -->
      <div class="payment-methods" *ngIf="!isProcessing">
        <h3>Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n</h3>
        <div class="method-grid">
          <div
            *ngFor="let method of paymentMethods"
            class="method-card"
            [class.selected]="paymentInfo.method === method.id"
            [class.disabled]="!method.available"
            (click)="onPaymentMethodSelect(method.id)"
          >
            <div class="method-icon">{{ method.icon }}</div>
            <div class="method-info">
              <h4>{{ method.name }}</h4>
              <p>{{ method.description }}</p>
            </div>
            <div class="method-radio">
              <input
                type="radio"
                name="paymentMethod"
                [value]="method.id"
                [checked]="paymentInfo.method === method.id"
                [disabled]="!method.available"
              />
            </div>
          </div>
        </div>
      </div>

      <!-- Payment Processing -->
      <div class="payment-processing" *ngIf="isProcessing">
        <div class="processing-header">
          <h3>ƒêang x·ª≠ l√Ω thanh to√°n</h3>
          <div class="countdown" *ngIf="countdown > 0">
            Th·ªùi gian c√≤n l·∫°i: {{ formatTime(countdown) }}
          </div>
        </div>

        <!-- VNPAY QR Code -->
        <div class="qr-payment" *ngIf="paymentInfo.method === 'vnpay' && qrCodeUrl">
          <div class="qr-container">
            <img [src]="qrCodeUrl" alt="QR Code" class="qr-code" />
            <p class="qr-instruction">Qu√©t m√£ QR b·∫±ng ·ª©ng d·ª•ng VNPAY ƒë·ªÉ thanh to√°n</p>
          </div>
          <div class="payment-actions">
            <button class="btn-secondary" (click)="onPaymentFailed()">H·ªßy thanh to√°n</button>
          </div>
        </div>

        <!-- Other Payment Methods -->
        <div class="gateway-payment" *ngIf="paymentInfo.method !== 'vnpay' && paymentUrl">
          <div class="gateway-info">
            <div class="gateway-icon">üîó</div>
            <div class="gateway-text">
              <h4>Chuy·ªÉn h∆∞·ªõng ƒë·∫øn c·ªïng thanh to√°n</h4>
              <p>Vui l√≤ng ho√†n t·∫•t thanh to√°n tr√™n trang ti·∫øp theo</p>
            </div>
          </div>
          <div class="payment-actions">
            <button class="btn-secondary" (click)="onPaymentFailed()">H·ªßy thanh to√°n</button>
          </div>
        </div>

        <!-- COD Confirmation -->
        <div class="cod-payment" *ngIf="paymentInfo.method === 'cod'">
          <div class="cod-info">
            <div class="cod-icon">üí∞</div>
            <div class="cod-text">
              <h4>Thanh to√°n khi nh·∫≠n h√†ng</h4>
              <p>B·∫°n s·∫Ω thanh to√°n khi nh·∫≠n ƒë∆∞·ª£c s·∫£n ph·∫©m</p>
              <div class="amount-display">
                T·ªïng ti·ªÅn:
                <strong style="color: #e53935">{{
                  paymentInfo.amount | currency : 'VND' : 'symbol' : '1.0-0' : 'vi'
                }}</strong>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Payment Summary -->
      <!-- <div class="payment-summary">
        <div class="summary-row">
          <span>T·ªïng ti·ªÅn h√†ng:</span>
          <span>{{ paymentInfo.amount | currency : 'VND' : 'symbol' : '1.0-0' : 'vi' }}</span>
        </div>
      </div> -->
    </div>

    <!-- Modal Footer -->
    <div class="modal-footer" *ngIf="!isProcessing">
      <button type="button" class="btn-secondary" (click)="onClose()">H·ªßy</button>
      <button
        type="button"
        class="btn-primary"
        (click)="onConfirmPayment()"
        [disabled]="!paymentInfo.method"
      >
        X√°c nh·∫≠n thanh to√°n
      </button>
    </div>
  </div>
</div>

<!-- Cancel Confirmation Popup -->
<div class="cancel-confirm-overlay" *ngIf="showCancelConfirm" (click)="cancelCancelPayment()">
  <div class="cancel-confirm-container" (click)="$event.stopPropagation()">
    <div class="cancel-confirm-header">
      <h3>X√°c nh·∫≠n h·ªßy thanh to√°n</h3>
      <button class="cancel-confirm-close" (click)="cancelCancelPayment()" aria-label="ƒê√≥ng">
        <span>&times;</span>
      </button>
    </div>
    <div class="cancel-confirm-body">
      <div class="cancel-confirm-icon">‚ö†Ô∏è</div>
      <p class="cancel-confirm-message">
        B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy thanh to√°n? ƒê∆°n h√†ng c·ªßa b·∫°n s·∫Ω kh√¥ng ƒë∆∞·ª£c x·ª≠ l√Ω.
      </p>
    </div>
    <div class="cancel-confirm-footer">
      <button class="btn-cancel" (click)="cancelCancelPayment()">Kh√¥ng</button>
      <button class="btn-confirm" (click)="confirmCancelPayment()">X√°c nh·∫≠n h·ªßy</button>
    </div>
  </div>
</div>
