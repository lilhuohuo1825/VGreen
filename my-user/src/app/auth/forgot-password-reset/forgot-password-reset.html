<div class="forgot-password-container">
  <div class="forgot-password-form">
    <h1 class="forgot-password-title">ĐẶT LẠI MẬT KHẨU</h1>

    <!-- Ẩn form khi hiển thị success message -->
    @if (!showSuccessMessage) {
    <form class="form" (ngSubmit)="onSubmit($event)">
      <!-- Phone Number Display (Locked) -->
      <div class="form-group">
        <label for="phone" class="form-label">Số điện thoại</label>
        <div class="input-container">
          <input
            type="tel"
            id="phone"
            name="phone"
            class="form-input locked-input"
            [value]="phoneNumber"
            readonly
            disabled
          />
        </div>
      </div>

      <!-- New Password Field -->
      <div class="form-group">
        <label for="password" class="form-label">Mật khẩu mới <sup>*</sup></label>
        <div class="input-container">
          <input
            [type]="showPassword ? 'text' : 'password'"
            id="password"
            name="password"
            class="form-input"
            placeholder="Mật khẩu gồm ít nhất 8 ký tự, 1 chữ cái in hoa"
            [value]="password"
            (input)="onPasswordInput($event)"
            required
          />
          <button type="button" class="toggle-password-btn" (click)="togglePassword()">
            <img
              [src]="
                showPassword ? '/asset/icons/eye_hide_dark.png' : '/asset/icons/eye_show_dark.png'
              "
              alt="Toggle password"
              class="icon"
            />
          </button>
        </div>
        <div class="error-container">
          @if (passwordError) {
          <div class="error-message">{{ passwordError }}</div>
          }
        </div>
      </div>

      <!-- Confirm Password Field -->
      <div class="form-group">
        <label for="confirmPassword" class="form-label">Nhập lại mật khẩu mới <sup>*</sup></label>
        <div class="input-container">
          <input
            [type]="showConfirm ? 'text' : 'password'"
            id="confirmPassword"
            name="confirmPassword"
            class="form-input"
            placeholder="Nhập lại mật khẩu mới vừa nhập"
            [value]="confirmPassword"
            (input)="onConfirmInput($event)"
            required
          />
          <button type="button" class="toggle-password-btn" (click)="toggleConfirm()">
            <img
              [src]="
                showConfirm ? '/asset/icons/eye_hide_dark.png' : '/asset/icons/eye_show_dark.png'
              "
              alt="Toggle confirm"
              class="icon"
            />
          </button>
        </div>
        <div class="error-container">
          @if (confirmError) {
          <div class="error-message">{{ confirmError }}</div>
          }
        </div>
      </div>

      <!-- Submit Button -->
      <button type="submit" class="reset-password-btn" [disabled]="!isFormValid() || isSubmitting">
        {{ isSubmitting ? 'Đang xử lý...' : 'Đặt lại mật khẩu' }}
      </button>
    </form>
    }

    <!-- Success Message -->
    @if (showSuccessMessage) {
    <div class="success-message">
      <div class="success-icon">
        <img src="/asset/icons/quote.png" alt="Success" class="icon" />
      </div>
      <div class="success-text">
        <h3>Đặt lại mật khẩu thành công!</h3>
        <p>Bạn có thể đăng nhập bằng số điện thoại và mật khẩu mới.</p>
      </div>
    </div>
    }

    <!-- Ẩn footer khi đang hiển thị success message -->
    @if (!showSuccessMessage) {
    <div class="forgot-password-footer">
      <span class="forgot-password-text">Nhớ mật khẩu?&nbsp;</span>
      @if (isPopupMode) {
      <a href="#" (click)="onLoginClick($event)" class="forgot-password-link">Đăng nhập ngay</a>
      } @else {
      <a routerLink="/login" class="forgot-password-link">Đăng nhập ngay</a>
      }
    </div>
    }
  </div>
</div>
